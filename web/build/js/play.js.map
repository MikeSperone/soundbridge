{"version":3,"sources":["../../src/js/play.js"],"names":[],"mappings":"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","file":"play.js","sourcesContent":["/**\r\n * Created by Mike on 8/30/16.\r\n */\r\n\r\nclass Play {\r\n    constructor(audio, context, vol = 0) {\r\n\r\n        this.audio = audio;\r\n        this.context = context;\r\n        this.contextCreationTime = new Date();\r\n        this.startTime = null;\r\n\r\n        this.buffer = null;\r\n        this.loopStart = 0;\r\n        this.loopEnd = 0;\r\n        this.stopped = true;\r\n\r\n\r\n        let that = this;\r\n        let req = new XMLHttpRequest();\r\n\r\n        req.open('GET', audio);\r\n        req.responseType = 'arraybuffer';\r\n\r\n        req.onload = function() {\r\n            let audioData = req.response;\r\n\r\n            that.context.decodeAudioData(audioData, function(buffer) {\r\n                    that.buffer = buffer;\r\n                    that.stopped = true;\r\n                    that.startSample();\r\n                    that.volume.gain.value = vol;\r\n                    that.audioLoadTimeOffset = (new Date() - that.contextCreationTime) / 1000;\r\n                },\r\n                function(e){console.log(\"Error with decoding audio data\" + e.err);});\r\n        };\r\n\r\n        req.send();\r\n    }\r\n\r\n    startSample(offset = 0) {\r\n        console.log(\"startSample\");\r\n\r\n        offset = (offset < 0) ? 0 : offset;\r\n        if (this.stopped === false) { this.stop(); }\r\n        this.src = this.context.createBufferSource();\r\n        this.volume = this.context.createGain();\r\n        this.src.buffer = this.buffer;\r\n\r\n        this.src.loop = true;\r\n        this.src.loopStart = this.loopStart;\r\n        this.src.loopEnd = this.loopEnd;\r\n\r\n        this.src.connect(this.volume);\r\n        this.volume.connect(this.context.destination);\r\n        this.startTime = this.context.currentTime - offset;\r\n\r\n        this.src.start(0, offset);\r\n        this.stopped = false;\r\n    }\r\n\r\n    get duration() {\r\n        return this.src.buffer.duration;\r\n    }\r\n\r\n    play() {\r\n        if (this.src) {\r\n            this.src.start();\r\n        }\r\n    }\r\n    stop() {\r\n        console.log('attempting to stop, stopped? ', this.stopped);\r\n        if (this.stopped === false) {\r\n            this.src.stop(0);\r\n            this.stopped = true;\r\n        }\r\n    }\r\n\r\n    get elapsedTime(){\r\n        return this.context.currentTime - this.startTime;\r\n    }\r\n\r\n    set position(x) {\r\n        this.loopStart = x;\r\n        //console.log(\"loop start: \"+this.loopStart);\r\n    }\r\n    get position() {\r\n        return this.loopStart;\r\n    }\r\n    set length(x) {\r\n        this.loopEnd = Math.min((this.position + x), this.duration);\r\n        //console.log(\"loop end: \"+this.loopEnd);\r\n    }\r\n    get length() {\r\n        return this.src.loopEnd - this.src.loopStart;\r\n    }\r\n    toString() {\r\n        return [{\"audio\": this.audio}, {\"context\": this.context}];\r\n    }\r\n\r\n    set vol(v) {\r\n        this.volume.gain.value = v;\r\n    }\r\n\r\n}"]}