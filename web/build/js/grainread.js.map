{"version":3,"sources":["../../src/js/grainread.js"],"names":[],"mappings":"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","file":"grainread.js","sourcesContent":["/**\n* Created by Mike on 8/25/16.\n*/\n\"use strict\";\nclass Grainread {\n\n    constructor(audio, context, g_read, g_multiply = 1, g_fade = 1, g_spread = 20, g_scatter = 28) {\n\n        this.g_read = g_read;\n        this.g_multiply = g_multiply;\n        this.g_fade = g_fade;\n        this.g_spread = g_spread;\n        this.g_scatter = (Math.random()*g_scatter)/127;\n\n        this.fb_amount = 0;\n        this.fb_position = 121;\n        this.fb_jitter = 272;\n\n        this.len = 12;\n\n        this.audio = audio;\n        this.context = context;\n        this.src = this.context.createBufferSource();\n        this.env = this.context.createGain();\n        this.split = this.context.createChannelSplitter(2);\n        this.merge = this.context.createChannelMerger(2);\n        this.delayA = this.context.createDelay(0.2);\n        this.delayB = this.context.createDelay(0.2);\n        this.fbkA = this.context.createGain();\n        this.fbkA.gain.value = 0.2;\n        this.fbkB = this.context.createGain();\n        this.fbkB.gain.value = 0.2;\n        this.volume = this.context.createGain();\n\n        let that = this;\n        let req = new XMLHttpRequest();\n\n        req.open('GET', audio);\n        req.responseType = 'arraybuffer';\n\n        req.onload = function() {\n            let audioData = req.response;\n\n            that.context.decodeAudioData(audioData, function(buffer) {\n                    that.src.buffer = buffer;\n                    that.src.connect(that.env);\n                    that.env.connect(that.split);\n                    that.split.connect(that.delayA, 0);\n                    that.split.connect(that.delayB, 1);\n                    that.delayA.connect(that.fbkA);\n                    that.delayB.connect(that.fbkB);\n                    that.fbkA.connect(that.delayA);\n                    that.fbkB.connect(that.delayB);\n                    that.delayA.connect(that.merge, 0, 0);\n                    that.delayB.connect(that.merge, 0, 1);\n                    that.src.loop = true;\n                    that.merge.connect(that.volume);\n                    that.volume.connect(context.destination);\n                    that.volume.gain.value = 0;\n                },\n                function(e){\"Error with decoding audio data\" + e.err});\n        };\n\n        req.send();\n        this.play();\n    }\n\n    play() {\n        this.src.start(0);\n    }\n\n    set vol(v) {\n        this.volume.gain.value = v;\n    }\n\n    set delays(d) {\n        this.delayA.delayTime.value = d;\n    }\n\n    set feedback(f) {\n        this.fbkA.gain.value = f;\n    }\n\n    set position(x) {\n        this.src.loopStart = x;\n    }\n    get position() {\n        return this.src.loopStart;\n    }\n    set length(x) {\n        this.src.loopEnd = this.position + x;\n    }\n    get length() {\n        return this.src.loopEnd - this.src.loopStart;\n    }\n\n    toString() {\n        return [{\"audio\":this.audio},{\"context\":this.context},{\"g_read\":this.g_read}, {\"g_speed\": this.g_speed}, {\"g_multiply\":this.g_multiply}, {\"g_fade\": this.g_fade}, {\"g_speedspread\": this.g_speedspread}, {\"g_spread\": this.g_spread}, {\"g_scatter\":this.g_scatter}];\n    }\n\n    set read(gr) {\n        this.g_read = gr;\n    }\n    get read() {\n        return this.g_read;\n    }\n    set speed(gs) {\n        this.g_speed = gs;\n    }\n    get speed() {\n        return this.g_speed;\n    }\n\n    set fade(gf) {\n        this.g_fade = gf;\n    }\n    get fade() {\n        return this.g_fade;\n    }\n    set speedspread(ss) {\n        this.g_speedspread = ss;\n    }\n    get speedspread() {\n        return this.g_speedspread;\n    }\n    set spread(gs) {\n        this.g_spread = gs;\n    }\n    get spread() {\n        return this.g_spread;\n    }\n    set scatter(gs) {\n        this.g_scatter = gs;\n    }\n    get scatter() {\n        return this.g_scatter;\n    }\n\n    onPhasor(t, time) {\n        \"use strict\";\n\n        // bottom right of GRAINREAD_Five\n        t.position = time;\n        t.length = t.g_read;\n        let now = t.context.currentTime;\n        let e = t.env.gain;\n        e.cancelScheduledValues(now);\n        e.setValueAtTime(0, now);\n        e.linearRampToValueAtTime(1, now + time/2);\n        e.linearRampToValueAtTime(0, now + time);\n        //console.log(\"enveloped\");\n        //console.log(time + \", \" + t.g_read);\n    }\n\n    phasor() {\n        let that = this;\n\n        var internalCallback = function() {\n            return function() {\n                    let time = (500/Math.random()) + 100;\n                    window.setTimeout(internalCallback, time);\n                    that.onPhasor(that, time/1000);\n                };\n        }();\n\n        window.setTimeout(internalCallback, 500);\n    }\n\n}\n\nfunction noise(spread) {\n    \"use strict\";\n    var noise = Math.random()*spread*20000;\n    return noise * noise;\n}"]}