{"version":3,"sources":["../../src/js/grainread.js"],"names":[],"mappings":"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","file":"grainread.js","sourcesContent":["/**\r\n * Grainread class\r\n * a single grain for the playgrain class\r\n * Created by Mike Sperone on 8/25/16.\r\n *\r\n *\r\n*/\r\n\r\nclass Grainread {\r\n\r\n    constructor(audio, context, g_read, g_multiply = 1, g_fade = 1, g_spread = 20, g_scatter = 28) {\r\n\r\n        this.g_read = g_read;\r\n        this.g_multiply = g_multiply;\r\n        this.g_fade = g_fade;\r\n        this.g_spread = g_spread;\r\n        this.g_scatter = (Math.random()*g_scatter)/127;\r\n\r\n        this.fb_amount = 0;\r\n        this.fb_position = 121;\r\n        this.fb_jitter = 272;\r\n\r\n        this.len = 12;\r\n\r\n        this.audio = audio;\r\n        this.context = context;\r\n        this.buffer = null;\r\n        this.duration = null;\r\n        this.stopped = true;\r\n\r\n        this.src = this.context.createBufferSource();\r\n        this.env = this.context.createGain();\r\n        this.panner = this.context.createStereoPanner();\r\n\r\n        this.split = this.context.createChannelSplitter(2);\r\n        this.merge = this.context.createChannelMerger(2);\r\n        this.delayA = this.context.createDelay(0.2);\r\n        this.delayB = this.context.createDelay(0.2);\r\n        this.fbkA = this.context.createGain();\r\n        this.fbkA.gain.value = 0.2;\r\n        this.fbkB = this.context.createGain();\r\n        this.fbkB.gain.value = 0.2;\r\n        this.volume = this.context.createGain();\r\n\r\n        let that = this;\r\n        let req = new XMLHttpRequest();\r\n\r\n        req.open('GET', audio);\r\n        req.responseType = 'arraybuffer';\r\n\r\n        req.onload = function() {\r\n            let audioData = req.response;\r\n\r\n            that.context.decodeAudioData(audioData, function(buffer) {\r\n                    that.src.buffer = buffer;\r\n                    that.buffer = buffer;\r\n                    that.duration = that.buffer.duration;\r\n                    that.src.connect(that.env);\r\n\r\n                    // that.env.connect(that.split);\r\n                    // that.split.connect(that.delayA, 0);\r\n                    // that.split.connect(that.delayB, 1);\r\n                    // that.delayA.connect(that.fbkA);\r\n                    // that.delayB.connect(that.fbkB);\r\n                    // that.fbkA.connect(that.delayA);\r\n                    // that.fbkB.connect(that.delayB);\r\n                    // that.delayA.connect(that.merge, 0, 0);\r\n                    // that.delayB.connect(that.merge, 0, 1);\r\n                    //\r\n                    // that.merge.connect(that.panner);\r\n\r\n                    that.src.loop = true;\r\n                    that.env.connect(that.panner);\r\n                    that.panner.connect(that.volume);\r\n                    that.volume.connect(context.destination);\r\n                    that.phasor();\r\n                },\r\n                function(e){\"Error with decoding audio data\" + e.err});\r\n        };\r\n\r\n        req.send();\r\n\r\n    }\r\n\r\n    restartAtTime(t) {\r\n        this.stop();\r\n        this.src = this.context.createBufferSource();\r\n        this.src.buffer = this.buffer;\r\n        this.src.loop = true;\r\n\r\n        this.src.connect(this.env);\r\n\r\n        this.src.start(0, t);\r\n        this.stopped = false;\r\n    }\r\n\r\n    play() {\r\n        this.src.start(0);\r\n    }\r\n\r\n    start() {\r\n        if (this.stopped) {\r\n            this.restartAtTime(0);\r\n            this.stopped = false;\r\n        }\r\n    }\r\n    stop() {\r\n        if (!this.stopped) {\r\n            this.src.stop(0);\r\n            this.stopped = true;\r\n        }\r\n    }\r\n\r\n    set vol(v) {\r\n        this.volume.gain.value = v;\r\n    }\r\n    get vol() {\r\n        return this.volume.gain.value;\r\n    }\r\n\r\n    set delays(d) {\r\n        this.delayA.delayTime.value = d;\r\n    }\r\n    get delays() {\r\n        return this.delayA.delayTime.value;\r\n    }\r\n\r\n    set feedback(f) {\r\n        this.fbkA.gain.value = f;\r\n    }\r\n    get feedback() {\r\n        return this.fbkA.gain.value;\r\n    }\r\n\r\n    set position(x) {\r\n        this.src.loopStart = x;\r\n    }\r\n    get position() {\r\n        return this.src.loopStart;\r\n    }\r\n    set length(x) {\r\n        this.src.loopEnd = this.position + x;\r\n    }\r\n    get length() {\r\n        return this.src.loopEnd - this.src.loopStart;\r\n    }\r\n\r\n    toString() {\r\n        return [{\"audio\":this.audio},{\"context\":this.context},{\"g_read\":this.g_read}, {\"g_speed\": this.g_speed}, {\"g_multiply\":this.g_multiply}, {\"g_fade\": this.g_fade}, {\"g_speedspread\": this.g_speedspread}, {\"g_spread\": this.g_spread}, {\"g_scatter\":this.g_scatter}];\r\n    }\r\n\r\n    set read(gr) {\r\n        this.g_read = gr;\r\n    }\r\n    get read() {\r\n        return this.g_read;\r\n    }\r\n    set speed(gs) {\r\n        this.g_speed = gs;\r\n    }\r\n    get speed() {\r\n        return this.g_speed;\r\n    }\r\n\r\n    set fade(gf) {\r\n        this.g_fade = gf;\r\n    }\r\n    get fade() {\r\n        return this.g_fade;\r\n    }\r\n    set speedspread(ss) {\r\n        this.g_speedspread = ss;\r\n    }\r\n    get speedspread() {\r\n        return this.g_speedspread;\r\n    }\r\n    set spread(gs) {\r\n        this.g_spread = gs;\r\n    }\r\n    get spread() {\r\n        return this.g_spread;\r\n    }\r\n    set scatter(gs) {\r\n        this.g_scatter = gs;\r\n    }\r\n    get scatter() {\r\n        return this.g_scatter;\r\n    }\r\n\r\n    phasor() {\r\n        let that = this;\r\n\r\n        var internalCallback = function() {\r\n\r\n            return function() {\r\n\r\n                let time = ((Math.random() * that.read)*2 + 0.1);\r\n                window.setTimeout(internalCallback, time * 1000);\r\n\r\n                if (that.stopped === false) {\r\n\r\n                    that.position = that.read * that.duration;\r\n                    that.length = time;\r\n                    that.panner.value = (that.spread * 0.4 * Math.random()) - 1;\r\n\r\n                    let now = that.context.currentTime;\r\n                    let e = that.env.gain;\r\n                    e.cancelScheduledValues(now);\r\n                    e.setValueAtTime(0.0001, now);\r\n\r\n                    that.restartAtTime(that.position);\r\n\r\n                    e.exponentialRampToValueAtTime(1, now + time / 2);\r\n                    e.exponentialRampToValueAtTime(0.0001, now + time);\r\n\r\n                }\r\n\r\n            };\r\n        }();\r\n\r\n        window.setTimeout(internalCallback, 500);\r\n    }\r\n\r\n}"]}