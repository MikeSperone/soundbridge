#!/usr/bin/env node

var app    = require("../app");
var config = require("../config/config.js");
var server = require('http').Server(app);
var io	   = require('socket.io')(server);

/**
*  Setting Numbers
*/
const newSetting = function() {
    return Math.floor(Math.random() * 29);
};

var currentSetting = newSetting();

io.on('connection', function(socket){

    console.log('user connected');
    socket.emit('setting', currentSetting);

    setTimeout(function(){
        currentSetting = newSetting();
        socket.emit('setting', currentSetting);
    }, 60 * 1000 * 30);

    socket.on('data', function(d) {
        socket.broadcast.emit('data', d);
    });
    socket.on('over', function(d) {
        socket.broadcast.emit('over', d);
    });
    socket.on('out', function(d) {
        socket.broadcast.emit('out', d);
    });
    socket.on('login', function(d) {
        console.log('login', d);
    });
    socket.on('logout', function(d) {
        console.log('logout', d);
    });

});

console.log('connecting...');
server.listen(Number(config.port), function() {
    console.log('connected to port ' + config.port);
});

